# LLMによるTerraformスクリプト生成の要件

0. ファイル構造とコメント
   - [ ] プロジェクトを main.tf, variables.tf, terraform.tfvars の3つのファイルに分割すること
   - [ ] 各ファイルの冒頭に、そのファイルの目的と内容を説明する詳細なコメントを追加すること
   - [ ] コメントは初心者でも理解できる平易な言葉で書くこと

1. リソース定義
   - [ ] 必要なAWSリソース（VPC、サブネット、EC2インスタンス、IAMロールなど）を正確に定義すること
   - [ ] リソース間の依存関係を適切に設定すること（例：サブネットはVPCに依存）

2. プロバイダー設定
   - [ ] AWSプロバイダーを適切に設定し、リージョンを指定すること

3. ネットワーク構成
   - [ ] VPCとサブネットのCIDRブロックを適切に設定すること
   - [ ] パブリックサブネットとプライベートサブネットを必要に応じて作成すること
   - [ ] インターネットゲートウェイとルートテーブルを適切に設定すること

4. セキュリティ設定
   - [ ] セキュリティグループを作成し、必要最小限のポートのみを開放すること
   - [ ] 22番ポート（SSH）は開放せず、代わりにセッションマネージャーを使用するための設定を行うこと
   - [ ] VPCエンドポイントを作成し、セッションマネージャーがプライベートサブネット内のインスタンスにアクセスできるようにすること

5. EC2インスタンス設定
   - [ ] 適切なAMIとインスタンスタイプを選択すること
   - [ ] ユーザーデータスクリプトを使用して、インスタンスの初期設定を行うこと
   - [ ] セッションマネージャーを使用するためのIAMロールをインスタンスにアタッチすること

6. IAMロールとポリシー設定
   - [ ] EC2インスタンス用のIAMロールを作成し、AmazonSSMManagedInstanceCoreポリシーをアタッチすること
   - [ ] 必要に応じて、カスタムポリシーを作成し、最小権限の原則に従ってアクセス権限を設定すること

7. セッションマネージャー設定
   - [ ] Systems Manager用のVPCエンドポイントを作成すること（ssm, ssmmessages, ec2messages）
   - [ ] セッションマネージャーのログ記録を設定すること（オプション）

8. Elastic IP設定
   - [ ] 必要に応じて、Elastic IPをEC2インスタンスに割り当てること

9. 出力設定
   - [ ] 重要な情報（インスタンスID、プライベートIPアドレスなど）を出力として定義すること

10. 変数の使用
    - [ ] 環境やデプロイメント間で変更される可能性のある値は変数として定義すること
    - [ ] 変数にはデフォルト値を設定し、必要に応じてoverrideできるようにすること

11. タグ付け
    - [ ] すべてのリソースに適切なタグを付けること（最低限、Nameタグは必須）

12. コメント
    - [ ] コードの主要な部分にコメントを追加し、目的や機能を説明すること

13. フォーマット
    - [ ] Terraformの標準的なコードフォーマットに従うこと（インデント、空行など）

14. エラーハンドリング
    - [ ] リソースの作成に失敗した場合の対応（例：depends_onの使用）を考慮すること

15. スクリプトの構造
    - [ ] 関連するリソースをグループ化し、論理的な順序で配置すること

16. 拡張性
    - [ ] 将来的な拡張や変更が容易になるような構造にすること

17. 特定のユースケース対応
    - [ ] 指定されたアプリケーション（例：Streamlit）の要件に合わせたリソース設定を行うこと

18. プロジェクト固有のパラメータの分離
    - [ ] メインのTerraformコード（main.tf）、変数定義（variables.tf）、プロジェクト固有のパラメータ（terraform.tfvars）を別々のファイルに分離すること
    - [ ] main.tfには再利用可能な一般的なインフラストラクチャコードを記述すること
    - [ ] variables.tfには使用するすべての変数の定義を記述すること
    - [ ] terraform.tfvarsにはプロジェクト固有の具体的な値を設定すること
    - [ ] 機密情報（APIキーなど）はterraform.tfvarsに直接記述せず、環境変数や別の安全な方法で管理すること

これらの要件に基づいてTerraformスクリプトを生成することで、LLMはセッションマネージャーを使用した安全なアクセス方法を実装し、運用性、保守性、可用性、セキュリティを考慮した実用的なインフラストラクチャコードを作成できるはずです。また、プロジェクト固有のパラメータを適切に分離することで、コードの再利用性と管理のしやすさが向上します。各ファイルの冒頭に追加されたコメントにより、初心者でもTerraformプロジェクトの構造と各ファイルの役割を理解しやすくなります。
